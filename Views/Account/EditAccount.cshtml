@model IllinoisProject.Models.Account
<link rel="stylesheet" href="~/css/AllAccount.css" />
<link rel="stylesheet" href="~/css/edit.css" />

<!-- Add the profile icon code here -->
<nav class="navbar">
    <div class="navbar-links">
        <div class="navbar-left">
            @if (User.Identity.IsAuthenticated)
            {
                <a asp-controller="BlogPost" asp-action="MyBlogPost">My Posts</a>
                <a asp-controller="BlogPost" asp-action="AddBlogPost"> Add a Blog </a>
                <a asp-controller="BlogPost" asp-action="AllDraft"> Drafts </a>
                <a asp-controller="BlogPost" asp-action="AllBlogPost"> All Blogs </a>
            }
            else
            {
                <a asp-controller="BlogPost" asp-action="AllBlogPost"> All Blogs </a>
            }
        </div>
        <div class="navbar-right">
            <div class="navbar-right">
                <!-- Only shows account stuff if the user is logged in-->
                @if (User.Identity.IsAuthenticated)
                {
                    <a asp-controller="Account" asp-action="AllAccount">View All Accounts</a>
                    <a asp-controller="Account" asp-action="MyAccount">MyAccount</a>
                    <form asp-controller="Account" asp-action="Logout" method="post">
                        <button type="submit">Logout</button>
                    </form>
                }
                else
                {
                    <a asp-controller="Account" asp-action="Login">Login</a>
                    <a asp-controller="Account" asp-action="Register">Register</a>
                }
            </div>
        </div>
    </div>
</nav>
<div class="profile-section">
    <h3>Edit Account</h3>
    <form asp-controller="Account" asp-action="EditAccount" method="post" enctype="multipart/form-data" id="editAccountForm">
        <input type="hidden" asp-for="Id" />

        <!-- Display the current profile picture if available -->
        @if (Model.Picture != null)
        {
            <div class="form-group">
                <img src="~/images/@Model.Picture.Url" alt="Profile Picture" />
            </div>
        }

        <!-- Add an input field for updating the profile picture -->
        <div class="form-group">
            <label asp-for="Name">Account Name</label>
            <input asp-for="Name" class="form-control" />
        </div>

        <div class="form-group">
            <label asp-for="UserName">Username</label>
            <input asp-for="UserName" class="form-control" />
        </div>

        <div class="form-group">
            <label asp-for="Email">Email</label>
            <input asp-for="Email" class="form-control" />
        </div>

        <div class="form-group">
            <div class="input-group">
                <input type="file" name="ProfilePicture" id="ProfilePicture" class="form-control" accept="image/*" style="display: none;" />
                <button type="button" id="changePictureBtn">Change Picture?</button>
            </div>
        </div>

        <!-- Add other fields you want to edit -->

        <button type="submit">Update Account</button>
    </form>
</div>

<script>
    // JavaScript to trigger file input click event when "Change Picture" button is clicked
    document.getElementById('changePictureBtn').addEventListener('click', function () {
        document.getElementById('ProfilePicture').click();
    });

    // JavaScript to submit the form when the file input changes
    document.getElementById('ProfilePicture').addEventListener('change', function () {
        document.getElementById('editAccountForm').submit();
    });

    // JavaScript to handle the form submission response
    document.getElementById('editAccountForm').addEventListener('submit', function (event) {
        event.preventDefault();
        var form = event.target;

        // Use Fetch API to submit the form data asynchronously
        fetch(form.action, {
            method: form.method,
            body: new FormData(form),
        })
        .then(response => {
            // Check if the response is successful (status code 200-299)
            if (response.ok) {
                // Redirect to the desired URL (replace 'new-url' with your actual URL)
                window.location.replace('new-url');
            } else {
                // Handle errors or display error messages
                console.error('Form submission failed:', response.statusText);
            }
        })
        .catch(error => {
            // Handle network errors
            console.error('Network error during form submission:', error);
        });
    });
</script>
